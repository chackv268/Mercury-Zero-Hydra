#############################################################################################################
# BASE SETUP
#############################################################################################################
[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
on_error_gcode: CANCEL_PRINT
[include shell_command.cfg]
[include mainsail.cfg]
[include heatsoak.cfg]
[include scanner.cfg]
[include enclosure.cfg]
[include timelapse.cfg]
[include macros.cfg]
[exclude_object]

#############################################################################################################
# MCUS, STEPPER MOTORS, DRIVERS 
#############################################################################################################
[include mcu.cfg]
[include motion_xy.cfg]
[include toolhead.cfg]
[include autotune.cfg]
[include sensorless-homing.cfg]
#[include Orbiter2_SmartSensor.cfg]
[include KOMB.cfg]
[include _KOMB_Variables.cfg]
[include stealthburner_leds.cfg]

#####################################################################
# 	Z Stepper Settings
#####################################################################
## Motor6
[stepper_z]
step_pin: PG9
dir_pin: !PD7
enable_pin: !PG11 
microsteps: 16
rotation_distance: 2
endstop_pin: probe:z_virtual_endstop
position_max: 270
position_min: -50
#position_endstop: 0
homing_speed: 4
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PG10
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110


## Motor7
[stepper_z1]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD6
microsteps: 16
rotation_distance: 2

[tmc2209 stepper_z1]
uart_pin: PD5
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110

## Motor8
[stepper_z2]
step_pin: PC7
dir_pin: !PC8
enable_pin: !PD2
microsteps: 16
rotation_distance: 2

[tmc2209 stepper_z2]
uart_pin: PC6
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110



#####################################################################
# 	Z Tilt Settings
#####################################################################

[z_tilt]
z_positions:
  16.67, 12.95  # Front Left
  144.27, 270.73  # Rear
  271.45, 14  #Front Right
  
  #17,  17 # Front Left
  #147, 267  # Rear
  #273, 13  # Front Right
points:
  40,  10    # Front Left 
  40,  220    # Back Left
  260, 220    # Back Right
  #145, 220   # Rear    
  260, 10    # Front Right 
 
speed: 400
horizontal_move_z: 30
retries: 15
retry_tolerance: 0.035
#autodetect_delta: 1.0
adaptive_horizontal_move_z: True
min_horizontal_move_z: 2.0

[scanner]
#scanner_touch_z_offset: 0.125         
#this is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset

#[skew_correction] 



#####################################################################
# 	Heater Bed Settings
#####################################################################

[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB 
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 62.901
#pid_ki: 1.808
#pid_kd: 547.241
min_temp: 0
max_temp: 130



[printer]
kinematics: corexy
max_velocity: 600
max_accel: 6000
#max_accel_to_decel: 7400
minimum_cruise_ratio: 0.5
max_z_velocity: 5
max_z_accel: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE7, EXP1_2=PG1,
    EXP1_3=PG0, EXP1_4=PF15,
    EXP1_5=PF14, EXP1_6=PF13,    # Slot in the socket on this side
    EXP1_7=PF12, EXP1_8=PF11,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PE15, EXP2_4=PE11,
    EXP2_5=PE10, EXP2_6=PE14,      # Slot in the socket on this side
    EXP2_7=PE8, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.



#######################################################################################################################################################
###############################     BLTOUCH     #######################################################################################################
#######################################################################################################################################################

#[bltouch]
#sensor_pin: PD13
#control_pin: PD12
#z_offset: 3
#x_offset = -35.75
#y_offset = -8.75



#######################################################################################################################################################
###############################    Klippain Shake and Tune     ########################################################################################
#######################################################################################################################################################

[shaketune]
result_folder: ~/printer_data/config/ShakeTune results
#    The folder where the results will be stored. It will be created if it doesn't exist.
number_of_results_to_keep: 10
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
keep_raw_data: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
timeout: 600
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.
measurements_chunk_size: 5
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.



#######################################################################################################################################################
###############################     CUSTOM GCODE      #######################################################################################################
#######################################################################################################################################################

# Enable arcs support
[gcode_arcs]
resolution: 0.1
    


#######################################################################################################################################################
###############################     SENSORS     #######################################################################################################
#######################################################################################################################################################

[include AFC/*.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_kp = 17.272
#*# pid_ki = 0.900
#*# pid_kd = 82.903
#*# pid_version = 1
#*# pid_target = 210.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 16.002
#*# pid_ki = 0.343
#*# pid_kd = 186.625
#*# pid_version = 1
#*# pid_target = 60.00
#*# pid_tolerance = 0.0200
#*#
#*# [input_shaper]
#*# shaper_type_x = smooth_mzv
#*# shaper_freq_x = 90.8
#*# damping_ratio_x = 0.051
#*# shaper_type_y = smooth_ei
#*# shaper_freq_y = 76.4
#*# damping_ratio_y = 0.050
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.067609, 0.073747, 0.076742, 0.078383, 0.080991, 0.083277, 0.084012, 0.092081, 0.091564, 0.089397, 0.088290, 0.086860, 0.084908, 0.083427, 0.081267, 0.079465, 0.077950, 0.075923, 0.072938, 0.071207, 0.069847, 0.068114, 0.064778, 0.060363, 0.056466, 0.055166, 0.053092, 0.047342, 0.044578, 0.038273
#*# 	  0.073083, 0.075155, 0.077694, 0.079041, 0.079390, 0.081989, 0.082604, 0.086586, 0.088345, 0.081524, 0.083451, 0.082329, 0.081719, 0.079817, 0.077439, 0.074802, 0.073189, 0.071862, 0.069425, 0.067840, 0.067724, 0.064681, 0.061708, 0.057341, 0.048766, 0.051534, 0.052586, 0.041782, 0.038550, 0.037708
#*# 	  0.074105, 0.077009, 0.078587, 0.078309, 0.078653, 0.081631, 0.082116, 0.084591, 0.083637, 0.078619, 0.077412, 0.076822, 0.076467, 0.074919, 0.073397, 0.071302, 0.068740, 0.068209, 0.065727, 0.065274, 0.063734, 0.060671, 0.057324, 0.052952, 0.049747, 0.046603, 0.041099, 0.036446, 0.029448, 0.024139
#*# 	  0.068673, 0.069265, 0.070886, 0.070731, 0.070781, 0.071247, 0.071936, 0.073717, 0.072105, 0.068641, 0.064074, 0.065013, 0.064758, 0.062868, 0.060708, 0.058993, 0.060261, 0.052621, 0.054937, 0.056035, 0.051215, 0.051603, 0.051390, 0.043904, 0.040507, 0.035798, 0.030563, 0.027493, 0.016685, 0.012363
#*# 	  0.062201, 0.064695, 0.065046, 0.065254, 0.065030, 0.064154, 0.063343, 0.063533, 0.059739, 0.056699, 0.053972, 0.052206, 0.053772, 0.052780, 0.051562, 0.049752, 0.046319, 0.044891, 0.043719, 0.042806, 0.043900, 0.042107, 0.038002, 0.034559, 0.030527, 0.024560, 0.019649, 0.013496, 0.006894, 0.002436
#*# 	  0.057241, 0.058396, 0.060590, 0.062165, 0.059910, 0.057800, 0.056656, 0.055754, 0.053080, 0.047590, 0.043024, 0.044960, 0.045030, 0.040072, 0.041060, 0.041677, 0.036879, 0.035488, 0.033866, 0.034347, 0.033839, 0.032318, 0.030302, 0.027183, 0.022515, 0.017085, 0.011502, 0.005555, 0.001424, -0.006182
#*# 	  0.054894, 0.055572, 0.059026, 0.058930, 0.057859, 0.056346, 0.054314, 0.052738, 0.049285, 0.043328, 0.040677, 0.039196, 0.037129, 0.035874, 0.033788, 0.031125, 0.029456, 0.028470, 0.026556, 0.028936, 0.027578, 0.025741, 0.024375, 0.021042, 0.017306, 0.012197, 0.006201, 0.000167, -0.001676, -0.008127
#*# 	  0.055526, 0.056126, 0.058217, 0.057579, 0.056500, 0.055364, 0.050364, 0.051109, 0.048655, 0.040722, 0.037681, 0.034623, 0.031719, 0.029600, 0.027087, 0.025700, 0.023860, 0.022593, 0.022881, 0.022674, 0.021145, 0.019344, 0.018095, 0.015263, 0.011679, 0.006005, 0.001841, -0.003339, -0.006339, -0.010252
#*# 	  0.055248, 0.055574, 0.055811, 0.055106, 0.053170, 0.051604, 0.049136, 0.046827, 0.042533, 0.038177, 0.033881, 0.029832, 0.027605, 0.024529, 0.022288, 0.020408, 0.018031, 0.016321, 0.015416, 0.015319, 0.014783, 0.013337, 0.010393, 0.007723, 0.004043, -0.001612, -0.004426, -0.009837, -0.015523, -0.018320
#*# 	  0.056923, 0.055718, 0.056175, 0.056624, 0.054772, 0.052126, 0.049442, 0.045371, 0.041268, 0.035304, 0.032001, 0.029102, 0.025319, 0.022378, 0.020639, 0.019228, 0.018185, 0.015864, 0.014151, 0.012700, 0.012018, 0.011801, 0.009177, 0.005251, -0.001137, -0.001998, -0.005864, -0.013059, -0.016792, -0.018232
#*# 	  0.054465, 0.055096, 0.054799, 0.054583, 0.051515, 0.051694, 0.046438, 0.042067, 0.040288, 0.033781, 0.029988, 0.026090, 0.023108, 0.019634, 0.017891, 0.015975, 0.013835, 0.011814, 0.009708, 0.008826, 0.008504, 0.008659, 0.006607, 0.002727, -0.000638, -0.005502, -0.010853, -0.015198, -0.019241, -0.023855
#*# 	  0.051903, 0.053096, 0.053287, 0.053476, 0.053041, 0.049872, 0.047380, 0.042421, 0.037291, 0.031470, 0.029307, 0.027009, 0.021808, 0.017770, 0.016692, 0.015440, 0.013956, 0.013427, 0.010302, 0.010399, 0.007037, 0.007983, 0.007474, 0.000186, -0.001154, -0.005163, -0.009262, -0.011768, -0.017268, -0.022863
#*# 	  0.049491, 0.048395, 0.049412, 0.048526, 0.048291, 0.043815, 0.041325, 0.037318, 0.032649, 0.030576, 0.024915, 0.019761, 0.018123, 0.013183, 0.009301, 0.011099, 0.009261, 0.006572, 0.004709, 0.004968, 0.004428, 0.001747, 0.000212, -0.001434, -0.004791, -0.010107, -0.013640, -0.018226, -0.020858, -0.025703
#*# 	  0.045193, 0.045141, 0.044483, 0.042636, 0.040226, 0.037588, 0.034704, 0.031240, 0.028492, 0.023995, 0.020643, 0.018176, 0.015987, 0.007559, 0.006702, 0.007229, 0.004268, 0.004193, 0.002619, 0.001257, -0.000680, -0.002068, -0.003644, -0.005842, -0.007929, -0.011893, -0.016017, -0.018043, -0.020270, -0.026099
#*# 	  0.041381, 0.041538, 0.038665, 0.036779, 0.034756, 0.033104, 0.029555, 0.025790, 0.022550, 0.018537, 0.014612, 0.011340, 0.009012, 0.005622, 0.001943, -0.000677, 0.000330, -0.002490, -0.005382, -0.002098, -0.004781, -0.006613, -0.007665, -0.010560, -0.012521, -0.015500, -0.018828, -0.022534, -0.024980, -0.027173
#*# 	  0.041458, 0.041159, 0.036920, 0.034996, 0.034111, 0.032772, 0.027129, 0.023029, 0.021836, 0.013859, 0.012054, 0.008862, 0.004793, 0.002529, 0.000000, -0.003293, -0.005003, -0.004385, -0.006634, -0.007409, -0.007447, -0.007341, -0.009993, -0.012685, -0.014647, -0.017112, -0.019592, -0.022007, -0.025045, -0.027770
#*# 	  0.040476, 0.039809, 0.037068, 0.036153, 0.034139, 0.031298, 0.028362, 0.025298, 0.020248, 0.017515, 0.012368, 0.007649, 0.004661, 0.002795, -0.001845, -0.003877, -0.004671, -0.005981, -0.006241, -0.006802, -0.007759, -0.008486, -0.010075, -0.010106, -0.015568, -0.018893, -0.019103, -0.021397, -0.025348, -0.027832
#*# 	  0.042676, 0.041647, 0.039012, 0.037267, 0.035912, 0.034182, 0.030394, 0.025314, 0.022039, 0.018325, 0.013229, 0.008415, 0.005476, 0.003665, 0.001292, -0.002162, -0.002232, -0.004033, -0.003503, -0.004689, -0.004629, -0.004595, -0.006992, -0.010657, -0.014353, -0.014524, -0.018944, -0.022345, -0.022968, -0.025255
#*# 	  0.043239, 0.042362, 0.039342, 0.037200, 0.036776, 0.034897, 0.031474, 0.025549, 0.021707, 0.017429, 0.014201, 0.008031, 0.006131, 0.003183, 0.001007, -0.001113, -0.001050, -0.000588, -0.000795, -0.001105, -0.002588, -0.004418, -0.007900, -0.011670, -0.013812, -0.015978, -0.017791, -0.021652, -0.022022, -0.023280
#*# 	  0.044038, 0.043122, 0.039739, 0.038850, 0.038255, 0.035323, 0.030586, 0.026612, 0.022601, 0.018733, 0.014345, 0.009621, 0.006192, 0.005342, 0.002493, 0.000729, 0.000860, 0.002196, 0.001735, 0.000258, -0.000122, -0.001606, -0.005764, -0.008420, -0.010725, -0.013700, -0.015905, -0.019295, -0.019873, -0.021285
#*# 	  0.041666, 0.038491, 0.038183, 0.036918, 0.035647, 0.033804, 0.029999, 0.023892, 0.019334, 0.018316, 0.011723, 0.005709, 0.004463, 0.001518, -0.003496, 0.000876, -0.002124, -0.000365, 0.000984, -0.000441, -0.002213, -0.004551, -0.006875, -0.010561, -0.013277, -0.014675, -0.018576, -0.021241, -0.022003, -0.024922
#*# 	  0.037478, 0.036656, 0.035324, 0.033053, 0.032813, 0.030828, 0.026283, 0.020999, 0.018233, 0.015251, 0.011282, 0.005620, 0.002225, -0.001820, -0.003134, -0.004601, -0.005667, -0.003234, -0.001375, -0.002065, -0.003437, -0.003815, -0.007641, -0.010122, -0.013877, -0.018096, -0.019843, -0.023068, -0.025635, -0.028570
#*# 	  0.033640, 0.033025, 0.032443, 0.029598, 0.029443, 0.028164, 0.024877, 0.020201, 0.015182, 0.011437, 0.006781, 0.001993, -0.001609, -0.003969, -0.004818, -0.007595, -0.002919, -0.004545, -0.009499, -0.002831, -0.006730, -0.009284, -0.007678, -0.012083, -0.015178, -0.018924, -0.021593, -0.026107, -0.029180, -0.031959
#*# 	  0.031524, 0.029938, 0.030272, 0.027596, 0.027859, 0.026793, 0.023527, 0.018980, 0.017227, 0.010871, 0.007057, 0.003656, -0.001874, -0.004874, -0.006054, -0.006726, -0.005689, -0.005623, -0.005879, -0.005844, -0.006195, -0.006958, -0.007602, -0.009240, -0.012980, -0.017897, -0.022845, -0.027713, -0.029363, -0.033366
#*# 	  0.031576, 0.029982, 0.027889, 0.026662, 0.025890, 0.025237, 0.023240, 0.019073, 0.017274, 0.012724, 0.006257, 0.002229, -0.000985, -0.004238, -0.005193, -0.004041, -0.005582, -0.004542, -0.003693, -0.004482, -0.005757, -0.007093, -0.012006, -0.007767, -0.014001, -0.018650, -0.021013, -0.027608, -0.029560, -0.031988
#*# 	  0.030830, 0.031571, 0.028738, 0.026341, 0.025814, 0.026646, 0.024024, 0.020451, 0.017630, 0.014007, 0.009871, 0.004323, -0.000228, -0.001934, -0.003076, -0.004068, -0.003942, -0.003190, -0.001761, -0.001820, -0.003756, -0.005076, -0.006672, -0.007020, -0.011388, -0.015256, -0.020304, -0.025977, -0.027458, -0.029696
#*# 	  0.030435, 0.030436, 0.026841, 0.023760, 0.022507, 0.025855, 0.021816, 0.017075, 0.018446, 0.013828, 0.010931, 0.007376, 0.002934, 0.000905, 0.000487, -0.000376, -0.002270, -0.000815, 0.000083, 0.001390, 0.001027, -0.002200, -0.004234, -0.006608, -0.010720, -0.014982, -0.018897, -0.024083, -0.026228, -0.028042
#*# 	  0.030532, 0.029697, 0.028819, 0.025348, 0.024411, 0.022662, 0.021511, 0.018607, 0.017482, 0.016555, 0.014068, 0.008855, 0.004920, 0.001821, -0.000214, -0.000997, -0.002469, -0.002035, 0.000486, 0.000658, 0.001581, 0.000766, -0.001142, -0.005850, -0.010683, -0.013701, -0.017729, -0.021537, -0.021250, -0.021216
#*# 	  0.029358, 0.027211, 0.027925, 0.025797, 0.023730, 0.022574, 0.021539, 0.017686, 0.015298, 0.018076, 0.013227, 0.007897, 0.006551, 0.004416, -0.000151, 0.004507, 0.000007, 0.000013, 0.001483, 0.001096, 0.002179, 0.002808, -0.001131, -0.004979, -0.008047, -0.012547, -0.015782, -0.018762, -0.016712, -0.010727
#*# 	  0.039540, 0.039447, 0.036857, 0.032695, 0.030278, 0.027438, 0.023128, 0.021153, 0.019490, 0.018042, 0.013490, 0.012297, 0.012704, 0.005167, 0.006003, 0.005296, -0.000737, 0.001600, 0.000801, 0.001940, 0.001841, 0.002364, 0.002002, -0.002708, -0.007040, -0.009574, -0.010843, -0.010964, -0.003276, 0.011470
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 40.0
#*# max_x = 260.0
#*# min_y = 37.0
#*# max_y = 230.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2500
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.125
#*#
#*# [scanner model default]
#*# model_coef = 1.3966782291387043,
#*# 	1.8341557360623564,
#*# 	0.7848777604099119,
#*# 	0.34815375580910807,
#*# 	0.30418445345765016,
#*# 	0.3454455893391014,
#*# 	-0.11461791296891402,
#*# 	-0.23811359335358015,
#*# 	0.18005093434614933,
#*# 	0.16242286669334224
#*# model_domain = 3.195548750831079e-07,3.315650501317732e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 44.104886
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [telemetry]
#*# enabled = True
