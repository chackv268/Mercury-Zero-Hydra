#############################################################################################################
# BASE SETUP
#############################################################################################################
[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
on_error_gcode: CANCEL_PRINT
[include shell_command.cfg]
[include mainsail.cfg]
[include heatsoak.cfg]
[include scanner.cfg]
[include enclosure.cfg]
[include timelapse.cfg]
[include macros.cfg]
[exclude_object]

#############################################################################################################
# MCUS, STEPPER MOTORS, DRIVERS 
#############################################################################################################
[include mcu.cfg]
[include motion_xy.cfg]
[include toolhead.cfg]
[include autotune.cfg]
[include sensorless-homing.cfg]
#[include Orbiter2_SmartSensor.cfg]
[include KOMB.cfg]
[include _KOMB_Variables.cfg]
#[include stealthburner_leds.cfg]

#####################################################################
# 	Z Stepper Settings
#####################################################################
## Motor6
[stepper_z]
step_pin: PG9
dir_pin: !PD7
enable_pin: !PG11 
microsteps: 16
rotation_distance: 2
endstop_pin: probe:z_virtual_endstop
position_max: 270
position_min: -50
#position_endstop: 0
homing_speed: 4
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PG10
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110


## Motor7
[stepper_z1]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD6
microsteps: 16
rotation_distance: 2

[tmc2209 stepper_z1]
uart_pin: PD5
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110

## Motor8
[stepper_z2]
step_pin: PC7
dir_pin: !PC8
enable_pin: !PD2
microsteps: 16
rotation_distance: 2

[tmc2209 stepper_z2]
uart_pin: PC6
run_current: 1.0
stealthchop_threshold: 999999
sense_resistor: 0.110



#####################################################################
# 	Z Tilt Settings
#####################################################################

[z_tilt]
z_positions:
  16.67, 12.95  # Front Left
  144.27, 270.73  # Rear
  271.45, 14  #Front Right
  
  #17,  17 # Front Left
  #147, 267  # Rear
  #273, 13  # Front Right
points:
  40,  10    # Front Left 
  40,  220    # Back Left
  260, 220    # Back Right
  #145, 220   # Rear    
  260, 10    # Front Right 
 
speed: 400
horizontal_move_z: 30
retries: 15
retry_tolerance: 0.035
#autodetect_delta: 1.0
adaptive_horizontal_move_z: True
min_horizontal_move_z: 2.0

[scanner]
#scanner_touch_z_offset: 0.125         
#this is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset

#[skew_correction] 



#####################################################################
# 	Heater Bed Settings
#####################################################################

[heater_bed]
heater_pin: PA0
sensor_pin: PB1 # TB 
sensor_type: EPCOS 100K B57560G104F
#control: pid
#pid_kp: 62.901
#pid_ki: 1.808
#pid_kd: 547.241
min_temp: 0
max_temp: 130



[printer]
kinematics: corexy
max_velocity: 600
max_accel: 6000
#max_accel_to_decel: 7400
minimum_cruise_ratio: 0.5
max_z_velocity: 5
max_z_accel: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE7, EXP1_2=PG1,
    EXP1_3=PG0, EXP1_4=PF15,
    EXP1_5=PF14, EXP1_6=PF13,    # Slot in the socket on this side
    EXP1_7=PF12, EXP1_8=PF11,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PE13, EXP2_2=PE12,
    EXP2_3=PE15, EXP2_4=PE11,
    EXP2_5=PE10, EXP2_6=PE14,      # Slot in the socket on this side
    EXP2_7=PE8, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.



#######################################################################################################################################################
###############################     BLTOUCH     #######################################################################################################
#######################################################################################################################################################

#[bltouch]
#sensor_pin: PD13
#control_pin: PD12
#z_offset: 3
#x_offset = -35.75
#y_offset = -8.75



#######################################################################################################################################################
###############################    Klippain Shake and Tune     ########################################################################################
#######################################################################################################################################################

[shaketune]
result_folder: ~/printer_data/config/ShakeTune results
#    The folder where the results will be stored. It will be created if it doesn't exist.
number_of_results_to_keep: 10
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
keep_raw_data: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
timeout: 600
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.
measurements_chunk_size: 5
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.



#######################################################################################################################################################
###############################     CUSTOM GCODE      #######################################################################################################
#######################################################################################################################################################

# Enable arcs support
[gcode_arcs]
resolution: 0.1
    


#######################################################################################################################################################
###############################     SENSORS     #######################################################################################################
#######################################################################################################################################################

[include AFC/*.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_kp = 17.272
#*# pid_ki = 0.900
#*# pid_kd = 82.903
#*# pid_version = 1
#*# pid_target = 210.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 16.002
#*# pid_ki = 0.343
#*# pid_kd = 186.625
#*# pid_version = 1
#*# pid_target = 60.00
#*# pid_tolerance = 0.0200
#*#
#*# [input_shaper]
#*# shaper_type_x = smooth_mzv
#*# shaper_freq_x = 90.8
#*# damping_ratio_x = 0.051
#*# shaper_type_y = smooth_ei
#*# shaper_freq_y = 76.4
#*# damping_ratio_y = 0.050
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.046367, -0.040667, -0.038868, -0.033828, -0.029002, -0.029509, -0.030515, -0.025107, -0.024424, -0.022747, -0.020509, -0.014008, -0.014514, -0.016132, -0.010564, -0.011990, -0.013278, -0.008757, -0.010182, -0.012695, -0.011713, -0.014283, -0.016140, -0.016809, -0.018974, -0.022899, -0.024832, -0.027993, -0.030240, -0.038315
#*# 	-0.036563, -0.036265, -0.031757, -0.028245, -0.021762, -0.030991, -0.025704, -0.020310, -0.028435, -0.021362, -0.014956, -0.020214, -0.015091, -0.008753, -0.018650, -0.014080, -0.010265, -0.008648, -0.016696, -0.011653, -0.007263, -0.018242, -0.013652, -0.009600, -0.021149, -0.018591, -0.016626, -0.026309, -0.033949, -0.032870
#*# 	-0.039062, -0.034559, -0.030593, -0.028757, -0.026570, -0.023690, -0.025464, -0.026340, -0.023192, -0.022335, -0.021656, -0.016129, -0.016597, -0.018103, -0.017190, -0.018518, -0.018636, -0.019083, -0.015642, -0.015171, -0.016567, -0.015531, -0.016606, -0.016472, -0.017623, -0.019757, -0.025025, -0.028882, -0.032107, -0.039878
#*# 	-0.032603, -0.029269, -0.025497, -0.022539, -0.025252, -0.021855, -0.019976, -0.023279, -0.019992, -0.018983, -0.017358, -0.020766, -0.017967, -0.015946, -0.020678, -0.017354, -0.015547, -0.019793, -0.016594, -0.013806, -0.016432, -0.016753, -0.013442, -0.018787, -0.016975, -0.015580, -0.027727, -0.027956, -0.028159, -0.039047
#*# 	-0.025957, -0.023877, -0.019141, -0.013932, -0.015015, -0.016289, -0.014224, -0.015319, -0.016231, -0.010375, -0.012043, -0.014971, -0.014359, -0.014447, -0.014897, -0.014027, -0.013459, -0.014231, -0.012610, -0.012731, -0.013435, -0.010774, -0.013069, -0.013294, -0.015253, -0.018583, -0.021688, -0.026579, -0.028922, -0.037746
#*# 	-0.016067, -0.011052, -0.007394, -0.004593, -0.005415, -0.005953, -0.005426, -0.006734, -0.005166, -0.004813, -0.006133, -0.006568, -0.005072, -0.008872, -0.007689, -0.006768, -0.007168, -0.006115, -0.004390, -0.007691, -0.006300, -0.004966, -0.007676, -0.007506, -0.007729, -0.015063, -0.017018, -0.021691, -0.024317, -0.032143
#*# 	-0.006890, -0.005443, 0.001545, -0.000838, 0.001572, 0.000015, -0.003209, 0.000917, -0.000285, -0.001113, 0.000416, -0.002143, -0.003215, -0.003311, -0.005039, -0.006853, -0.002881, -0.003049, -0.003845, -0.001334, -0.003084, -0.005062, -0.003352, -0.006408, -0.010768, -0.010998, -0.017952, -0.020026, -0.022089, -0.028861
#*# 	-0.005374, -0.000008, 0.002062, 0.004041, 0.003622, 0.002615, 0.001775, 0.003141, 0.002521, 0.002349, 0.001797, 0.001174, -0.001632, -0.003176, -0.003153, -0.003595, -0.002393, -0.001570, -0.002235, 0.000480, -0.000636, -0.003512, -0.004090, -0.007204, -0.008307, -0.013238, -0.016981, -0.019886, -0.021113, -0.028015
#*# 	-0.006330, -0.000063, 0.000841, -0.000211, 0.003602, 0.001956, -0.001157, 0.002725, 0.001058, -0.001328, -0.001358, 0.000137, -0.003044, -0.005696, -0.004886, -0.006489, -0.005766, -0.003202, -0.004820, -0.005301, -0.005180, -0.009236, -0.012510, -0.014333, -0.015473, -0.019662, -0.020855, -0.025295, -0.028000, -0.032124
#*# 	-0.005973, -0.002569, -0.000143, 0.001934, 0.003158, -0.001327, 0.000713, 0.000066, -0.002667, -0.001065, -0.000607, -0.003212, -0.003233, -0.005475, -0.010132, -0.008957, -0.008156, -0.006026, -0.009007, -0.007000, -0.006481, -0.013875, -0.015689, -0.017062, -0.024067, -0.023636, -0.025866, -0.030830, -0.032452, -0.036437
#*# 	-0.003659, 0.000542, 0.002439, 0.003537, 0.002160, 0.007028, 0.003358, -0.000075, 0.003265, 0.001010, -0.002012, 0.001433, -0.003187, -0.007109, -0.003989, -0.007484, -0.009311, -0.006255, -0.007921, -0.010383, -0.013239, -0.013053, -0.018214, -0.023082, -0.024653, -0.026963, -0.030883, -0.031473, -0.030711, -0.039658
#*# 	0.001759, 0.005546, 0.007310, 0.008420, 0.006842, 0.007736, 0.007367, 0.005400, 0.005082, 0.002913, 0.005439, 0.003669, 0.003143, 0.005414, 0.001540, -0.000521, -0.000933, -0.002728, -0.005018, -0.006612, -0.012217, -0.011234, -0.012770, -0.021624, -0.021241, -0.023495, -0.025891, -0.028436, -0.029169, -0.033875
#*# 	0.010294, 0.009088, 0.011252, 0.014171, 0.012043, 0.009603, 0.013351, 0.011099, 0.007930, 0.010899, 0.011810, 0.007886, 0.008464, 0.007790, 0.003676, 0.009318, 0.006568, 0.003024, -0.001866, -0.003892, -0.006673, -0.006479, -0.009645, -0.012709, -0.014211, -0.016048, -0.018039, -0.021103, -0.020551, -0.025939
#*# 	0.010287, 0.012414, 0.013913, 0.014170, 0.013278, 0.013435, 0.012450, 0.011242, 0.009310, 0.009027, 0.011172, 0.010691, 0.008652, 0.007926, 0.008526, 0.007831, 0.005465, 0.003480, -0.000047, -0.003390, -0.004825, -0.005590, -0.007330, -0.007971, -0.009621, -0.011801, -0.014743, -0.016371, -0.018156, -0.021353
#*# 	0.010693, 0.010982, 0.013812, 0.010362, 0.011708, 0.009230, 0.006174, 0.007548, 0.005255, 0.004740, 0.010741, 0.007150, 0.004550, 0.002906, 0.003720, 0.001349, 0.001275, -0.001167, -0.004221, -0.003108, -0.005566, -0.006979, -0.007529, -0.010523, -0.012778, -0.012757, -0.017247, -0.018913, -0.018593, -0.022327
#*# 	0.006651, 0.009318, 0.009806, 0.008040, 0.009058, 0.007377, 0.003440, 0.000805, 0.000668, 0.001497, 0.000850, 0.001894, -0.000213, -0.001508, 0.000000, -0.001748, -0.002782, -0.001043, -0.004408, -0.005178, -0.005037, -0.009312, -0.009471, -0.012563, -0.012439, -0.016449, -0.018121, -0.019481, -0.022134, -0.024836
#*# 	0.005418, 0.007249, 0.006861, 0.005302, 0.007519, 0.003393, -0.000219, -0.000460, -0.002539, -0.004405, -0.003635, -0.000694, -0.001961, -0.005799, -0.001718, -0.003185, -0.003610, -0.004631, -0.005502, -0.005690, -0.004180, -0.007820, -0.010618, -0.013787, -0.016338, -0.018519, -0.018008, -0.020670, -0.021372, -0.024387
#*# 	0.004188, 0.003393, 0.004743, 0.004073, 0.005277, 0.002481, 0.001322, 0.000184, -0.004673, -0.003548, -0.002237, -0.002875, -0.002469, -0.004180, -0.005207, -0.003887, -0.003630, -0.004384, -0.004115, -0.003625, -0.004202, -0.007046, -0.008728, -0.012657, -0.015463, -0.016384, -0.017725, -0.018183, -0.018250, -0.022671
#*# 	0.004121, 0.005610, 0.006272, 0.006604, 0.005410, 0.006175, 0.003112, -0.001109, -0.001133, -0.003260, -0.004901, -0.000499, -0.001867, -0.003943, -0.000825, -0.004523, -0.005613, -0.006047, -0.000622, -0.002101, -0.003461, -0.001984, -0.005835, -0.008534, -0.009193, -0.012876, -0.015391, -0.016214, -0.015784, -0.021327
#*# 	0.005940, 0.007501, 0.007624, 0.008939, 0.009390, 0.007694, 0.006443, -0.000168, -0.001099, -0.003135, -0.002843, -0.002027, -0.002047, -0.002766, -0.004864, -0.006335, -0.003970, -0.004328, -0.002917, -0.001071, -0.000309, -0.000443, -0.001130, -0.007374, -0.008559, -0.010250, -0.014296, -0.014989, -0.014382, -0.019772
#*# 	0.008607, 0.007393, 0.011394, 0.013910, 0.013512, 0.009070, 0.006091, 0.001689, -0.000490, -0.000780, -0.002168, -0.003539, -0.000806, -0.002345, -0.005194, -0.003607, -0.004227, -0.005163, 0.002741, 0.001006, -0.001337, 0.002667, -0.000384, -0.002997, -0.005344, -0.006349, -0.010590, -0.012522, -0.011864, -0.017241
#*# 	0.004125, 0.005970, 0.007300, 0.009806, 0.007894, 0.006632, 0.003742, -0.000487, -0.002289, -0.003277, -0.005327, -0.004540, -0.003083, -0.007955, -0.007649, -0.007103, -0.005473, -0.002590, -0.001944, -0.000937, -0.002151, -0.001908, -0.003822, -0.004708, -0.006379, -0.008025, -0.011498, -0.013064, -0.014307, -0.018880
#*# 	0.000887, 0.001943, 0.005808, 0.002713, 0.005505, 0.001328, -0.003207, -0.006355, -0.007236, -0.007971, -0.007142, -0.008245, -0.011609, -0.011554, -0.012025, -0.013253, -0.006756, -0.006301, -0.007199, -0.003061, -0.005735, -0.010691, -0.005378, -0.009055, -0.012997, -0.011340, -0.014359, -0.017208, -0.019744, -0.022712
#*# 	-0.006443, -0.004143, -0.001798, 0.001299, 0.000253, -0.001953, -0.008288, -0.009672, -0.011854, -0.013375, -0.013052, -0.014246, -0.018373, -0.019509, -0.018488, -0.017681, -0.015983, -0.013165, -0.012328, -0.012048, -0.012526, -0.011291, -0.012025, -0.012269, -0.013507, -0.014977, -0.019838, -0.022975, -0.022808, -0.024434
#*# 	-0.011721, -0.007165, -0.006399, -0.005878, -0.002472, -0.005658, -0.008115, -0.011636, -0.015036, -0.016845, -0.017747, -0.017284, -0.019677, -0.023634, -0.021435, -0.020920, -0.020602, -0.015475, -0.016237, -0.018180, -0.013091, -0.015246, -0.016721, -0.011774, -0.013904, -0.016407, -0.019507, -0.022558, -0.024157, -0.024982
#*# 	-0.015368, -0.012823, -0.010214, -0.008905, -0.006002, -0.008536, -0.009983, -0.013068, -0.015122, -0.015910, -0.017021, -0.019742, -0.019797, -0.021851, -0.023302, -0.021727, -0.019059, -0.017376, -0.014787, -0.016589, -0.018003, -0.017874, -0.017586, -0.016152, -0.015247, -0.018587, -0.021270, -0.024122, -0.023976, -0.025247
#*# 	-0.017319, -0.016928, -0.015687, -0.011932, -0.012316, -0.008683, -0.012893, -0.016690, -0.015389, -0.017315, -0.020004, -0.017722, -0.018114, -0.019952, -0.019101, -0.022322, -0.024248, -0.014406, -0.013716, -0.016789, -0.019124, -0.014857, -0.017722, -0.019744, -0.015003, -0.018833, -0.024018, -0.025550, -0.024842, -0.028080
#*# 	-0.020798, -0.020525, -0.020142, -0.018422, -0.016874, -0.017094, -0.018338, -0.021282, -0.022593, -0.021656, -0.022694, -0.020505, -0.022034, -0.022015, -0.025062, -0.024994, -0.026556, -0.024740, -0.021727, -0.021627, -0.018933, -0.022218, -0.021812, -0.022054, -0.022754, -0.024561, -0.026075, -0.027493, -0.029383, -0.032247
#*# 	-0.027102, -0.026488, -0.024229, -0.024086, -0.023911, -0.025143, -0.025973, -0.028331, -0.028520, -0.027049, -0.030558, -0.032346, -0.031551, -0.031365, -0.033061, -0.032724, -0.034574, -0.034946, -0.027441, -0.027392, -0.029677, -0.024223, -0.027851, -0.030250, -0.027437, -0.031722, -0.032230, -0.034042, -0.035151, -0.037304
#*# 	-0.033286, -0.029513, -0.028177, -0.028519, -0.029992, -0.030154, -0.031307, -0.032749, -0.033392, -0.034659, -0.036334, -0.037246, -0.036640, -0.038875, -0.038940, -0.038295, -0.037650, -0.037234, -0.037035, -0.031424, -0.030763, -0.031247, -0.031177, -0.032745, -0.035820, -0.032744, -0.036004, -0.037941, -0.037154, -0.037472
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 40.0
#*# max_x = 260.0
#*# min_y = 37.0
#*# max_y = 230.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 3250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.125
#*#
#*# [scanner model default]
#*# model_coef = 1.3966782291387043,
#*# 	1.8341557360623564,
#*# 	0.7848777604099119,
#*# 	0.34815375580910807,
#*# 	0.30418445345765016,
#*# 	0.3454455893391014,
#*# 	-0.11461791296891402,
#*# 	-0.23811359335358015,
#*# 	0.18005093434614933,
#*# 	0.16242286669334224
#*# model_domain = 3.195548750831079e-07,3.315650501317732e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 44.104886
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [telemetry]
#*# enabled = True
